# bannerService

## Стэк
- Go (gin)
- Redis
- Postgres

## Общее
Сервис крутится на 3000 порте.
Спецификация доступна на ресурсе /docs/swagger. 

## Сборка сервиса
В репозитории не заигнорены файлы окружения, поэтому проект можно сразу собрать через компоуз:
```bash
docker compose --env-file=.env.prod up
```

## Создание юзера
Для работы с сервисом необходимо создать юзера путем отправки POST запроса с следующим блобом на /signup/:
```json
{
  "username": "test",
  "password": "test",
  "role": 2,
}
```
Роли соответствуют числам 1 и 2 - юзер и админ.

Эндпоинт ответит парой токенов. Аксес токен, в соответствии со спецификацией, нужно использовать как значение хедера "token".

## Вопросы и решения
1. Наверное первым вопросом с достаточно очевидным ответом являлось хранение самих баннеров - учитывая, что лукап по полям жсонов не был указан в требованиях, и в целом не имеет смысла в нашем юзкейсе, хранить баннеры стоит как сырые байты. В постгре обычный json тип по сути является последовательностью байт без наворотов, поэтому было принято решение использовать его
2. Чтобы обеспечить юзкейс с токенами, были реализованы эндпоинты для регистрации и логина (/signup/ и /login/), оба из которых возвращают пару токенов (рефреш/аксес), а также написан миддлвэр для валидации токенов.
3. Для учета 5 пункта задания подключен редис с TTL 5 минут, при отправке флага use_last_revision мы ходим в базу и обновляем кэш.
4. Выключение баннеров реализовано только для ручки /user_banner, поскольку остальные ручки доступны только админам.
